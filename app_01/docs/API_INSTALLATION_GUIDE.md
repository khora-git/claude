# SearchFirm CRM ë°±ì—”ë“œ API ì„¤ì¹˜ ê°€ì´ë“œ

## ğŸ“ íŒŒì¼ êµ¬ì¡°

ì„œë²„ì— ë‹¤ìŒê³¼ ê°™ì€ êµ¬ì¡°ë¡œ ì—…ë¡œë“œí•˜ì„¸ìš”:

```
/your-gnuboard-root/
â”œâ”€ common.php               (ê¸°ì¡´ íŒŒì¼)
â”œâ”€ data/                    (ê¸°ì¡´ í´ë”)
â”‚   â””â”€ app_tokens/          (ìƒˆë¡œ ìƒì„±ë¨ - ìë™)
â”‚
â””â”€ api/                     (ìƒˆë¡œ ë§Œë“¤ í´ë”)
    â”œâ”€ app_login_api.php           (ì—…ë¡œë“œ)
    â”œâ”€ get_consultants_api.php     (ì—…ë¡œë“œ)
    â””â”€ search_candidate_api.php    (ì—…ë¡œë“œ)
```

---

## ğŸš€ ì„¤ì¹˜ ë‹¨ê³„

### 1ë‹¨ê³„: í´ë” ìƒì„±

FTP ë˜ëŠ” íŒŒì¼ ê´€ë¦¬ìì—ì„œ:
1. ê·¸ëˆ„ë³´ë“œ ë£¨íŠ¸ í´ë”ì— `/api` í´ë” ìƒì„±
2. í´ë” ê¶Œí•œ: 755

### 2ë‹¨ê³„: íŒŒì¼ ì—…ë¡œë“œ

ë‹¤ìŒ 3ê°œ íŒŒì¼ì„ `/api/` í´ë”ì— ì—…ë¡œë“œ:
- âœ… app_login_api.php
- âœ… get_consultants_api.php  
- âœ… search_candidate_api.php

### 3ë‹¨ê³„: íŒŒì¼ ê¶Œí•œ ì„¤ì •

```bash
chmod 644 /api/*.php
```

### 4ë‹¨ê³„: common.php ê²½ë¡œ í™•ì¸

ê° API íŒŒì¼ ìƒë‹¨ì˜ ê²½ë¡œê°€ ë§ëŠ”ì§€ í™•ì¸:

```php
// api í´ë”ê°€ ê·¸ëˆ„ë³´ë“œ ë£¨íŠ¸ ë°”ë¡œ ì•„ë˜ì— ìˆìœ¼ë©´:
if (file_exists('../common.php')) {
    include_once '../common.php';
}

// api í´ë”ê°€ ë‹¤ë¥¸ ìœ„ì¹˜ì— ìˆìœ¼ë©´ ê²½ë¡œ ìˆ˜ì •:
// ì˜ˆ: /home/user/public_html/gnuboard/api/
// â†’ include_once '../common.php';  (í•œ ë‹¨ê³„ ìœ„)
// â†’ include_once '../../common.php';  (ë‘ ë‹¨ê³„ ìœ„)
```

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ë°©ë²•

### ë°©ë²• 1: ì›¹ ë¸Œë¼ìš°ì € í…ŒìŠ¤íŠ¸ (ê¶Œì¥)

1. `api_test.html` íŒŒì¼ì„ ì»´í“¨í„°ì—ì„œ ì—´ê¸°
2. ì²« ë²ˆì§¸ ì…ë ¥ë€ì— ì„œë²„ URL ì…ë ¥
   - ì˜ˆ: `https://your-domain.com/api`
3. ì»¨ì„¤í„´íŠ¸ ì•„ì´ë””/ë¹„ë°€ë²ˆí˜¸ ì…ë ¥
4. "ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸" ë²„íŠ¼ í´ë¦­
5. ì„±ê³µí•˜ë©´ í† í°ì´ ìë™ìœ¼ë¡œ ì…ë ¥ë¨
6. ë‚˜ë¨¸ì§€ APIë„ ì°¨ë¡€ëŒ€ë¡œ í…ŒìŠ¤íŠ¸

### ë°©ë²• 2: cURL í…ŒìŠ¤íŠ¸ (ëª…ë ¹ì¤„)

```bash
# 1. ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸
curl -X POST https://your-domain.com/api/app_login_api.php \
  -H "Content-Type: application/json" \
  -d '{"mb_id":"test_id","mb_password":"test_pw"}'

# ì„±ê³µ ì‘ë‹µ ì˜ˆì‹œ:
# {
#   "success": true,
#   "data": {
#     "token": "abc123def456...",
#     "user": {...}
#   }
# }

# 2. ì»¨ì„¤í„´íŠ¸ ëª©ë¡ ì¡°íšŒ (ìœ„ì—ì„œ ë°›ì€ í† í° ì‚¬ìš©)
curl -X GET https://your-domain.com/api/get_consultants_api.php \
  -H "Authorization: Bearer abc123def456..."

# 3. í›„ë³´ì ê²€ìƒ‰ (ì „í™”ë²ˆí˜¸ë¡œ)
curl -X GET "https://your-domain.com/api/search_candidate_api.php?phone=01012345678" \
  -H "Authorization: Bearer abc123def456..."
```

---

## âš™ï¸ API ì‚¬ìš© ë°©ë²•

### 1. ë¡œê·¸ì¸ API

**ì—”ë“œí¬ì¸íŠ¸:** `POST /api/app_login_api.php`

**ìš”ì²­:**
```json
{
  "mb_id": "consultant_id",
  "mb_password": "password123"
}
```

**ì‘ë‹µ (ì„±ê³µ):**
```json
{
  "success": true,
  "data": {
    "token": "a1b2c3d4e5f6...",
    "user": {
      "mb_id": "consultant_id",
      "mb_name": "í™ê¸¸ë™",
      "mb_nick": "ê¸¸ë™",
      "mb_email": "hong@example.com",
      "mb_hp": "010-1234-5678",
      "mb_level": "10"
    }
  },
  "message": "ë¡œê·¸ì¸ ì„±ê³µ"
}
```

**ì‘ë‹µ (ì‹¤íŒ¨):**
```json
{
  "success": false,
  "error": "LOGIN_FAILED",
  "message": "ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤"
}
```

---

### 2. ì»¨ì„¤í„´íŠ¸ ëª©ë¡ API

**ì—”ë“œí¬ì¸íŠ¸:** `GET /api/get_consultants_api.php`

**í—¤ë”:**
```
Authorization: Bearer {token}
```

**ì‘ë‹µ:**
```json
{
  "success": true,
  "data": {
    "consultants": [
      {
        "id": "user1",
        "name": "ê¹€íŒ€ì¥",
        "nick": "íŒ€ì¥ë‹˜",
        "phone": "01011112222",
        "phone_formatted": "010-1111-2222",
        "email": "kim@example.com",
        "level": "10",
        "joined_at": "2024-01-15 10:30:00"
      },
      {
        "id": "user2",
        "name": "ì´ì»¨ì„¤í„´íŠ¸",
        "nick": "ì´ëŒ€ë¦¬",
        "phone": "01033334444",
        "phone_formatted": "010-3333-4444",
        "email": "lee@example.com",
        "level": "10",
        "joined_at": "2024-02-20 14:20:00"
      }
    ],
    "total": 2,
    "synced_at": "2025-10-03 15:30:00"
  },
  "message": "ì»¨ì„¤í„´íŠ¸ ëª©ë¡ ì¡°íšŒ ì„±ê³µ"
}
```

---

### 3. í›„ë³´ì ê²€ìƒ‰ API (í•µì‹¬!)

**ì—”ë“œí¬ì¸íŠ¸:** `GET /api/search_candidate_api.php?phone={ì „í™”ë²ˆí˜¸}`

**í—¤ë”:**
```
Authorization: Bearer {token}
```

**ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°:**
- `phone`: ì „í™”ë²ˆí˜¸ (ìˆ«ìë§Œ ë˜ëŠ” í•˜ì´í”ˆ í¬í•¨ ëª¨ë‘ ê°€ëŠ¥)
  - ì˜ˆ: `01012345678` ë˜ëŠ” `010-1234-5678`

**ì‘ë‹µ (í›„ë³´ì ìˆìŒ):**
```json
{
  "success": true,
  "data": {
    "found": true,
    "candidates": [
      {
        "id": "12345",
        "parent_id": "100",
        "name": "í™ê¸¸ë™",
        "phone_numbers": "010-1234-5678",
        "email": "hong@email.com",
        "stage": "2ì°¨ ì¸í„°ë·° ì§„í–‰ì¤‘",
        "applied_position": "ë°±ì—”ë“œ ê°œë°œì",
        "applied_company": "ABC ì£¼ì‹íšŒì‚¬",
        "consultant_1_id": "user1",
        "consultant_2_id": "user2",
        "registered_at": "2025-09-15 14:30:00",
        "last_updated": "2025-10-03 10:20:00"
      }
    ],
    "total": 1,
    "phone": "01012345678"
  },
  "message": "í›„ë³´ì ì •ë³´ ì¡°íšŒ ì„±ê³µ"
}
```

**ì°¸ê³ :** ì»¨ì„¤í„´íŠ¸ ì´ë¦„ì´ í•„ìš”í•˜ë©´ `consultant_1_id`ë¡œ ì•±ì—ì„œ ë³„ë„ ì¡°íšŒí•˜ê±°ë‚˜, ë¡œê·¸ì¸ ì‹œ ë°›ì€ ì»¨ì„¤í„´íŠ¸ ëª©ë¡ì„ í™œìš©í•˜ì„¸ìš”.

**ì‘ë‹µ (í›„ë³´ì ì—†ìŒ):**
```json
{
  "success": true,
  "data": {
    "found": false,
    "candidates": [],
    "total": 0,
    "phone": "01099998888"
  },
  "message": "ë“±ë¡ëœ í›„ë³´ìê°€ ì—†ìŠµë‹ˆë‹¤"
}
```

---

## ğŸ” ë³´ì•ˆ ì„¤ì •

### 1. HTTPS ì‚¬ìš© (í•„ìˆ˜!)

- HTTPê°€ ì•„ë‹Œ **HTTPS**ë¡œë§Œ API ì ‘ê·¼
- Let's Encrypt ë¬´ë£Œ SSL ì¸ì¦ì„œ ì‚¬ìš© ê¶Œì¥

### 2. CORS ì„¤ì • (ì„ íƒ)

íŠ¹ì • ë„ë©”ì¸ë§Œ í—ˆìš©í•˜ë ¤ë©´ ê° API íŒŒì¼ ìƒë‹¨ ìˆ˜ì •:

```php
// ëª¨ë“  ë„ë©”ì¸ í—ˆìš© (í˜„ì¬ ì„¤ì •)
header('Access-Control-Allow-Origin: *');

// íŠ¹ì • ë„ë©”ì¸ë§Œ í—ˆìš© (ê¶Œì¥)
header('Access-Control-Allow-Origin: https://your-app-domain.com');
```

### 3. Rate Limiting (ì¶”ì²œ)

API ë‚¨ìš© ë°©ì§€ë¥¼ ìœ„í•´ ë‚˜ì¤‘ì— ì¶”ê°€:
- ê°™ì€ IPì—ì„œ 1ë¶„ì— 60íšŒ ì´ìƒ ìš”ì²­ ì°¨ë‹¨
- ì‹¤íŒ¨í•œ ë¡œê·¸ì¸ ì‹œë„ 5íšŒ ì´ìƒ ì‹œ 10ë¶„ ì°¨ë‹¨

---

## â— ë¬¸ì œ í•´ê²° (Troubleshooting)

### ë¬¸ì œ 1: "ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì‹¤íŒ¨"
```
ì›ì¸: common.php íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ
í•´ê²°: 
1. API íŒŒì¼ì—ì„œ common.php ê²½ë¡œ í™•ì¸
2. include_once '../common.php'; ë¥¼ 
   include_once '../../common.php'; ë¡œ ë³€ê²½ ì‹œë„
```

### ë¬¸ì œ 2: ë¡œê·¸ì¸ì€ ë˜ëŠ”ë° í† í° ì €ì¥ ì‹¤íŒ¨
```
ì›ì¸: /data/ í´ë” ì“°ê¸° ê¶Œí•œ ì—†ìŒ
í•´ê²°:
chmod 707 /your-gnuboard/data
ë˜ëŠ”
chmod 777 /your-gnuboard/data
```

### ë¬¸ì œ 3: í›„ë³´ì ê²€ìƒ‰ ì‹œ í•­ìƒ ë¹ˆ ê²°ê³¼
```
ì›ì¸1: ë¡œê·¸ì¸í•œ ì»¨ì„¤í„´íŠ¸ê°€ ë‹´ë‹¹í•˜ì§€ ì•Šì€ í›„ë³´ì
í•´ê²°: SQL ì¡°ê±´ í™•ì¸ (wr_10, wr_22 í•„ë“œ)

ì›ì¸2: ì „í™”ë²ˆí˜¸ í˜•ì‹ì´ ë‹¤ë¦„
í•´ê²°: DBì— ì €ì¥ëœ ì „í™”ë²ˆí˜¸ í˜•ì‹ í™•ì¸
     wr_3 í•„ë“œì— ì „í™”ë²ˆí˜¸ê°€ ì €ì¥ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
     ì˜ˆ: "010-1234-5678" ë˜ëŠ” "01012345678"

ì›ì¸3: wr_is_comment í•„ë“œ ê°’ í™•ì¸
í•´ê²°: í›„ë³´ì ë°ì´í„°ê°€ wr_is_comment = '1' (ë¬¸ìì—´)ë¡œ 
     ì €ì¥ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
```

### ë¬¸ì œ 4: CORS ì—ëŸ¬
```
Access to fetch at '...' from origin '...' has been blocked by CORS policy

í•´ê²°: ê° API íŒŒì¼ ìƒë‹¨ì— ë‹¤ìŒ ì¶”ê°€:
header('Access-Control-Allow-Origin: *');
header('Access-Control-Allow-Methods: GET, POST, OPTIONS');
header('Access-Control-Allow-Headers: Content-Type, Authorization');
```

---

## ğŸ“Š ë°ì´í„°ë² ì´ìŠ¤ í™•ì¸ì‚¬í•­

### í•„ìš”í•œ í…Œì´ë¸”:
1. **g5_member** - ì»¨ì„¤í„´íŠ¸ ì •ë³´
   - `mb_level = '10'` ì¸ íšŒì›ë§Œ ì•± ì‚¬ìš© ê°€ëŠ¥

2. **g5_write_project** - í”„ë¡œì íŠ¸ ë° í›„ë³´ì
   - `wr_is_comment = 0`: í”„ë¡œì íŠ¸ (ë¶€ëª¨)
   - `wr_is_comment = 1`: í›„ë³´ì (ëŒ“ê¸€)

### í•„ë“œ ë§¤í•‘:
```
í›„ë³´ì ëŒ“ê¸€ í•„ë“œ (g5_write_project where wr_is_comment='1'):
- wr_21: í›„ë³´ì ì´ë¦„ â­
- wr_3: ì „í™”ë²ˆí˜¸ â­
- wr_4: ì´ë©”ì¼ â­
- wr_content: ì§„í–‰ë‹¨ê³„ â­
- wr_8: ì§€ì› í¬ì§€ì…˜ëª… â­
- wr_12: ì§€ì› ê³ ê°ì‚¬ëª… â­
- wr_10: ì»¨ì„¤í„´íŠ¸ 1 ID â­
- wr_22: ì»¨ì„¤í„´íŠ¸ 2 ID â­
```

---

## âœ… ìµœì¢… ì²´í¬ë¦¬ìŠ¤íŠ¸

ì„¤ì¹˜ ì™„ë£Œ ì „ í™•ì¸:

- [ ] /api/ í´ë” ìƒì„±ë¨
- [ ] 3ê°œ PHP íŒŒì¼ ì—…ë¡œë“œë¨
- [ ] íŒŒì¼ ê¶Œí•œ 644 ì„¤ì •ë¨
- [ ] common.php ê²½ë¡œ í™•ì¸ë¨
- [ ] HTTPS ì ìš©ë¨ (ì¤‘ìš”!)
- [ ] ë¡œê·¸ì¸ API í…ŒìŠ¤íŠ¸ ì„±ê³µ
- [ ] ì»¨ì„¤í„´íŠ¸ ëª©ë¡ API í…ŒìŠ¤íŠ¸ ì„±ê³µ
- [ ] í›„ë³´ì ê²€ìƒ‰ API í…ŒìŠ¤íŠ¸ ì„±ê³µ
- [ ] í† í° ì •ìƒ ìƒì„±ë¨

ëª¨ë“  í•­ëª©ì´ ì²´í¬ë˜ë©´ ë°±ì—”ë“œ ì¤€ë¹„ ì™„ë£Œ! ğŸ‰

---

## ğŸ“ ë‹¤ìŒ ë‹¨ê³„

ë°±ì—”ë“œ APIê°€ ì •ìƒ ì‘ë™í•˜ë©´:

1. **ì•± ê°œë°œ í™˜ê²½ ì„¤ì •** (React Native ë˜ëŠ” Flutter)
2. **ë¡œê·¸ì¸ í™”ë©´ ë§Œë“¤ê¸°**
3. **ì „í™” ê°ì§€ ê¸°ëŠ¥ ì¶”ê°€**
4. **ì˜¤ë²„ë ˆì´ íŒì—… êµ¬í˜„**
5. **í…ŒìŠ¤íŠ¸ ë° ë°°í¬**

ì¤€ë¹„ë˜ë©´ ë‹¤ìŒ ë‹¨ê³„ë¡œ ì§„í–‰í•˜ì„¸ìš”!
